<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ë£Œê´‘ê³  AI ì‹¬ì˜ ì‹œìŠ¤í…œ</title>
    <style>
        /* ì „ì—­ ìŠ¤íƒ€ì¼ ë¦¬ì…‹ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* ì•± ì»¨í…Œì´ë„ˆ */
        .app {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* í—¤ë” */
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header-title {
            font-size: 2rem;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .header-subtitle {
            font-size: 1rem;
            color: #718096;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            flex: 1;
            max-width: 1200px;
            width: 100%;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        /* ì—…ë¡œë“œ ì„¹ì…˜ */
        .upload-section {
            margin-bottom: 2rem;
        }

        .upload-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .upload-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            color: #667eea;
        }

        .upload-header h2 {
            font-size: 1.5rem;
            color: #2d3748;
        }

        /* íŒŒì¼ ì…ë ¥ ì˜ì—­ */
        .file-input-area {
            margin-bottom: 1.5rem;
        }

        .file-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 2rem;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f7fafc;
        }

        .file-label:hover {
            border-color: #667eea;
            background: #edf2f7;
        }

        .file-text {
            font-size: 1.1rem;
            color: #2d3748;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .file-hint {
            font-size: 0.9rem;
            color: #718096;
        }

        .file-input {
            display: none;
        }

        /* ë¯¸ë¦¬ë³´ê¸° */
        .preview-section {
            margin: 1.5rem 0;
            display: none;
        }

        .preview-section.show {
            display: block;
        }

        .preview-section h3 {
            font-size: 1.1rem;
            color: #2d3748;
            margin-bottom: 1rem;
        }

        .preview-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* ì—ëŸ¬ ë©”ì‹œì§€ */
        .error-message {
            display: none;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            background: #fed7d7;
            color: #c53030;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .error-message.show {
            display: flex;
        }

        /* AI ì˜µì…˜ */
        .ai-option {
            margin-top: 1rem;
            padding: 1rem;
            background: #f7fafc;
            border-radius: 8px;
            display: none;
        }

        .ai-option.show {
            display: block;
        }

        .ai-option label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .ai-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .ai-option span {
            font-weight: 500;
            color: #2d3748;
        }

        /* ë²„íŠ¼ ê·¸ë£¹ */
        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
            display: none;
        }

        .btn-secondary.show {
            display: flex;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ê²°ê³¼ ì„¹ì…˜ */
        .result-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .result-section.show {
            display: block;
        }

        .result-section h2 {
            font-size: 1.8rem;
            color: #2d3748;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .result-card {
            background: #f7fafc;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .result-card h3 {
            font-size: 1.3rem;
            color: #2d3748;
            margin-bottom: 1rem;
        }

        /* ì¢…í•© íŒì • ì¹´ë“œ */
        .judgment-card {
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border: 2px solid #e2e8f0;
        }

        .judgment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .judgment-badge {
            padding: 0.5rem 1.5rem;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .judgment-badge.passed {
            background: #48bb78;
            color: white;
        }

        .judgment-badge.rejected {
            background: #e53e3e;
            color: white;
        }

        .judgment-content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .judgment-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
        }

        .judgment-label {
            font-size: 0.9rem;
            color: #718096;
            font-weight: 600;
        }

        .judgment-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
        }

        .risk-badge-large {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .risk-safe { color: #38a169; }
        .risk-low { color: #48bb78; }
        .risk-medium { color: #ed8936; }
        .risk-high { color: #e53e3e; }
        .risk-critical { color: #c53030; background: #fed7d7; }

        .judgment-summary {
            padding: 1rem;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .judgment-summary p {
            color: #4a5568;
            line-height: 1.6;
            margin: 0;
        }

        /* OCR í…ìŠ¤íŠ¸ í•˜ì´ë¼ì´íŒ… */
        .ocr-text-highlighted {
            color: #2d3748;
            line-height: 1.8;
            margin-bottom: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 6px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .highlight-high {
            background: #fed7d7;
            color: #c53030;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        .highlight-medium {
            background: #feebc8;
            color: #c05621;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        .highlight-low {
            background: #fefcbf;
            color: #744210;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        .ocr-confidence {
            font-size: 0.9rem;
            color: #718096;
        }

        /* ìœ„ë°˜ ì‚¬í•­ ìƒì„¸ */
        .violations-detail-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .violation-detail-card {
            background: white;
            border-radius: 8px;
            border-left: 4px solid #cbd5e0;
            overflow: hidden;
        }

        .violation-detail-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #f7fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .violation-severity-badge {
            padding: 0.35rem 0.7rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .violation-severity-badge.high {
            background: #fed7d7;
            color: #c53030;
        }

        .violation-severity-badge.medium {
            background: #feebc8;
            color: #c05621;
        }

        .violation-severity-badge.low {
            background: #fefcbf;
            color: #744210;
        }

        .violation-keyword-main {
            font-size: 1.1rem;
            font-weight: 700;
            color: #2d3748;
            flex: 1;
        }

        .violation-score-badge {
            padding: 0.35rem 0.7rem;
            background: #edf2f7;
            color: #2d3748;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
        }

        .violation-detail-body {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .violation-info-row {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .info-label {
            font-weight: 600;
            color: #4a5568;
            min-width: 100px;
            font-size: 0.9rem;
        }

        .info-value {
            color: #2d3748;
            flex: 1;
        }

        .law-text {
            color: #667eea;
            font-weight: 500;
        }

        .bonus-indicator {
            color: #e53e3e;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .violation-description {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding-top: 0.5rem;
        }

        .violation-description p {
            margin: 0;
            padding: 0.75rem;
            background: #f7fafc;
            border-radius: 6px;
            color: #4a5568;
            line-height: 1.6;
        }

        /* AI ë¶„ì„ ê·¼ê±° */
        .ai-analysis-card {
            background: linear-gradient(135deg, #f0f4ff 0%, #e6f0ff 100%);
            border: 2px solid #667eea;
        }

        .ai-analysis-content {
            padding: 1rem;
            background: white;
            border-radius: 8px;
        }

        .ai-analysis-text {
            margin: 0;
            padding: 1rem;
            background: #f7fafc;
            border-radius: 6px;
            color: #2d3748;
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 0.95rem;
            border-left: 4px solid #667eea;
        }

        /* í‘¸í„° */
        .footer {
            background: rgba(255, 255, 255, 0.95);
            padding: 1.5rem;
            text-align: center;
            color: #718096;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        /* ì„ íƒëœ íŒŒì¼ ëª©ë¡ */
        .selected-files-list {
            margin-top: 1rem;
            padding: 1rem;
            background: #f7fafc;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .selected-files-list.show {
            display: block;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            margin: 0.25rem 0;
            background: white;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .file-item-name {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-item-size {
            color: #718096;
            margin-left: 1rem;
            font-size: 0.8rem;
        }

        /* ì§„í–‰ë¥  ì„¹ì…˜ */
        .progress-section {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #f7fafc;
            border-radius: 8px;
        }

        .progress-section h3 {
            margin-bottom: 1rem;
            color: #2d3748;
            font-size: 1.1rem;
        }

        .progress-bar-container {
            width: 100%;
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }

        #progress-text {
            text-align: center;
            color: #4a5568;
            font-weight: 500;
        }

        /* ë°°ì¹˜ ê²°ê³¼ ì„¹ì…˜ */
        .batch-result-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .batch-result-section h2 {
            margin-bottom: 1.5rem;
            color: #2d3748;
        }

        /* í…Œì´ë¸” ì»¨íŠ¸ë¡¤ */
        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .filter-group {
            display: flex;
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .sort-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sort-group label {
            font-weight: 500;
            color: #4a5568;
        }

        .sort-group select {
            padding: 0.5rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* ê²°ê³¼ í…Œì´ë¸” */
        .table-wrapper {
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        #results-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        #results-table th {
            background: #f7fafc;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #2d3748;
            border-bottom: 2px solid #e2e8f0;
        }

        #results-table td {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            vertical-align: middle;
        }

        #results-table tr:hover {
            background: #f7fafc;
        }

        .table-judgment {
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-weight: 600;
            display: inline-block;
        }

        .table-judgment.passed {
            background: #c6f6d5;
            color: #22543d;
        }

        .table-judgment.rejected {
            background: #fed7d7;
            color: #742a2a;
        }

        .table-judgment.review {
            background: #feebc8;
            color: #7c2d12;
        }

        .table-risk-badge {
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }

        .table-risk-badge.risk-safe {
            background: #c6f6d5;
            color: #22543d;
        }

        .table-risk-badge.risk-low {
            background: #bee3f8;
            color: #2c5282;
        }

        .table-risk-badge.risk-medium {
            background: #feebc8;
            color: #7c2d12;
        }

        .table-risk-badge.risk-high {
            background: #fed7d7;
            color: #742a2a;
        }

        .table-risk-badge.risk-critical {
            background: #feb2b2;
            color: #742a2a;
        }

        .view-detail-btn {
            padding: 0.4rem 0.8rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .view-detail-btn:hover {
            background: #5568d3;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .header-title { font-size: 1.5rem; }
            .main-content { padding: 0 0.5rem; }
            .upload-card, .result-section { padding: 1rem; }
            .button-group { flex-direction: column; }
            .btn { width: 100%; }
            .judgment-content { grid-template-columns: 1fr; }
            .violation-info-row { flex-direction: column; gap: 0.25rem; }
            .info-label { min-width: auto; }
            .table-controls { flex-direction: column; align-items: flex-start; }
            #results-table { font-size: 0.85rem; }
            #results-table th, #results-table td { padding: 0.5rem; }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- í—¤ë” -->
        <header class="header">
            <div class="header-content">
                <h1 class="header-title">ì˜ë£Œê´‘ê³  AI ì‹¬ì˜ ì‹œìŠ¤í…œ</h1>
                <p class="header-subtitle">ì˜ë£Œê´‘ê³  ì´ë¯¸ì§€ì˜ ë²•ê·œ ì¤€ìˆ˜ ì—¬ë¶€ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤</p>
            </div>
        </header>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- ì—…ë¡œë“œ ì„¹ì…˜ -->
            <div class="upload-section">
                <div class="upload-card">
                    <div class="upload-header">
                        <h2>ğŸ“¤ ê´‘ê³  ì´ë¯¸ì§€ ì—…ë¡œë“œ</h2>
                    </div>

                    <!-- íŒŒì¼ ì„ íƒ ì˜ì—­ -->
                    <div class="file-input-area">
                        <label for="file-input" class="file-label">
                            <span class="file-text" id="file-name">ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</span>
                            <span class="file-hint">JPG, PNG (ìµœëŒ€ 10MB)</span>
                        </label>
                        <input
                            id="file-input"
                            type="file"
                            accept="image/jpeg,image/jpg,image/png"
                            class="file-input"
                        />
                    </div>

                    <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° -->
                    <div id="preview-section" class="preview-section">
                        <h3>ë¯¸ë¦¬ë³´ê¸°</h3>
                        <img id="preview-image" class="preview-image" alt="Preview">
                    </div>

                    <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
                    <div id="error-message" class="error-message">
                        <span id="error-text"></span>
                    </div>

                    <!-- AI ë¶„ì„ ì˜µì…˜ -->
                    <div id="ai-option" class="ai-option">
                        <label>
                            <input type="checkbox" id="use-ai">
                            <span>GPT-4 AI ë¶„ì„ ì‚¬ìš© (ë²•ê·œ ê·¼ê±° í¬í•¨, ì²˜ë¦¬ ì‹œê°„ +15ì´ˆ)</span>
                        </label>
                    </div>

                    <!-- ë¶„ì„ ë²„íŠ¼ -->
                    <div class="button-group">
                        <button id="analyze-btn" class="btn btn-primary" disabled>
                            ë¶„ì„ ì‹œì‘
                        </button>
                        <button id="reset-btn" class="btn btn-secondary">
                            ì´ˆê¸°í™”
                        </button>
                    </div>
                </div>
            </div>

            <!-- ë°°ì¹˜ ì—…ë¡œë“œ ì„¹ì…˜ -->
            <div class="upload-section">
                <div class="upload-card">
                    <div class="upload-header">
                        <h2>ë°°ì¹˜ ë¶„ì„ (ë‹¤ì¤‘ íŒŒì¼)</h2>
                    </div>

                    <!-- ë‹¤ì¤‘ íŒŒì¼ ì„ íƒ ì˜ì—­ -->
                    <div class="file-input-area">
                        <label for="batch-file-input" class="file-label">
                            <span class="file-text">ì—¬ëŸ¬ ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš” (ìµœëŒ€ 50ê°œ)</span>
                            <span class="file-hint">JPG, PNG (íŒŒì¼ë‹¹ ìµœëŒ€ 10MB)</span>
                        </label>
                        <input
                            id="batch-file-input"
                            type="file"
                            accept="image/jpeg,image/jpg,image/png"
                            class="file-input"
                            multiple
                        />
                    </div>

                    <!-- ì„ íƒëœ íŒŒì¼ ëª©ë¡ -->
                    <div id="selected-files-list" class="selected-files-list"></div>

                    <!-- ë°°ì¹˜ AI ë¶„ì„ ì˜µì…˜ -->
                    <div id="batch-ai-option" class="ai-option" style="display: none;">
                        <label>
                            <input type="checkbox" id="batch-use-ai">
                            <span>GPT-4 AI ë¶„ì„ ì‚¬ìš© (ë²•ê·œ ê·¼ê±° í¬í•¨, ì²˜ë¦¬ ì‹œê°„ +15ì´ˆ/íŒŒì¼)</span>
                        </label>
                    </div>

                    <!-- ë°°ì¹˜ ë¶„ì„ ë²„íŠ¼ -->
                    <div class="button-group">
                        <button id="batch-analyze-btn" class="btn btn-primary" disabled>
                            ë°°ì¹˜ ë¶„ì„ ì‹œì‘
                        </button>
                        <button id="batch-reset-btn" class="btn btn-secondary" style="display: none;">
                            ì´ˆê¸°í™”
                        </button>
                    </div>

                    <!-- ì§„í–‰ë¥  ì„¹ì…˜ -->
                    <div id="progress-section" class="progress-section" style="display: none;">
                        <h3>ë¶„ì„ ì§„í–‰ ì¤‘...</h3>
                        <div class="progress-bar-container">
                            <div id="progress-bar" class="progress-bar"></div>
                        </div>
                        <p id="progress-text">0/0 (0%)</p>
                    </div>
                </div>
            </div>

            <!-- ë°°ì¹˜ ê²°ê³¼ í…Œì´ë¸” ì„¹ì…˜ -->
            <div id="batch-result-section" class="batch-result-section" style="display: none;">
                <h2>ë°°ì¹˜ ë¶„ì„ ê²°ê³¼</h2>

                <!-- í•„í„° ë° ì •ë ¬ ì»¨íŠ¸ë¡¤ -->
                <div class="table-controls">
                    <div class="filter-group">
                        <button class="filter-btn active" data-filter="all">ì „ì²´</button>
                        <button class="filter-btn" data-filter="approved">í†µê³¼</button>
                        <button class="filter-btn" data-filter="rejected">ë°˜ë ¤</button>
                        <button class="filter-btn" data-filter="review">ê²€í† </button>
                    </div>
                    <div class="sort-group">
                        <label>ì •ë ¬:</label>
                        <select id="sort-select">
                            <option value="filename">íŒŒì¼ëª…</option>
                            <option value="score">ì ìˆ˜</option>
                            <option value="risk">ìœ„í—˜ë„</option>
                        </select>
                    </div>
                </div>

                <!-- ê²°ê³¼ í…Œì´ë¸” -->
                <div class="table-wrapper">
                    <table id="results-table">
                        <thead>
                            <tr>
                                <th>íŒŒì¼ëª…</th>
                                <th>íŒì •</th>
                                <th>ì´ì </th>
                                <th>ìœ„í—˜ë„</th>
                                <th>ìœ„ë°˜ ê±´ìˆ˜</th>
                                <th>ìƒì„¸ë³´ê¸°</th>
                            </tr>
                        </thead>
                        <tbody id="results-table-body"></tbody>
                    </table>
                </div>

                <!-- ë¶„ë¥˜ ë²„íŠ¼ -->
                <div class="button-group">
                    <button id="classify-btn" class="btn btn-primary">
                        ì „ì²´ ìŠ¹ì¸ ë° ë¶„ë¥˜
                    </button>
                </div>
            </div>

            <!-- ê²°ê³¼ ì„¹ì…˜ (ë‹¨ì¼ íŒŒì¼) -->
            <div id="result-section" class="result-section">
                <h2>ë¶„ì„ ê²°ê³¼</h2>
                <div id="result-content"></div>
            </div>
        </main>

        <!-- í‘¸í„° -->
        <footer class="footer">
            <p>ì˜ë£Œê´‘ê³  AI ì‹¬ì˜ ì‹œìŠ¤í…œ MVP v1.0</p>
        </footer>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000';
        let selectedFile = null;

        // DOM ìš”ì†Œ
        const fileInput = document.getElementById('file-input');
        const fileName = document.getElementById('file-name');
        const previewSection = document.getElementById('preview-section');
        const previewImage = document.getElementById('preview-image');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const aiOption = document.getElementById('ai-option');
        const useAI = document.getElementById('use-ai');
        const analyzeBtn = document.getElementById('analyze-btn');
        const resetBtn = document.getElementById('reset-btn');
        const resultSection = document.getElementById('result-section');
        const resultContent = document.getElementById('result-content');

        // íŒŒì¼ ì„ íƒ í•¸ë“¤ëŸ¬
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            // íŒŒì¼ íƒ€ì… ê²€ì¦
            if (!file.type.startsWith('image/')) {
                showError('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            // íŒŒì¼ í¬ê¸° ê²€ì¦ (10MB)
            if (file.size > 10 * 1024 * 1024) {
                showError('íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }

            selectedFile = file;
            fileName.textContent = file.name;
            errorMessage.classList.remove('show');
            resultSection.classList.remove('show');
            aiOption.classList.add('show');
            resetBtn.classList.add('show');
            analyzeBtn.disabled = false;

            // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
            const reader = new FileReader();
            reader.onloadend = () => {
                previewImage.src = reader.result;
                previewSection.classList.add('show');
            };
            reader.readAsDataURL(file);
        });

        // ë¶„ì„ ì‹œì‘
        analyzeBtn.addEventListener('click', async () => {
            if (!selectedFile) {
                showError('íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë¡œë”© ìƒíƒœ
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<span class="spinner"></span> ë¶„ì„ ì¤‘...';
            errorMessage.classList.remove('show');
            resultSection.classList.remove('show');

            try {
                console.log('ğŸ” Starting analysis...', selectedFile.name);

                const formData = new FormData();
                formData.append('file', selectedFile);
                formData.append('use_ai', useAI.checked ? 'true' : 'false');

                console.log('ğŸ“¤ Sending request to:', `${API_BASE_URL}/api/ocr-analyze`);

                const response = await fetch(`${API_BASE_URL}/api/ocr-analyze`, {
                    method: 'POST',
                    body: formData
                });

                console.log('ğŸ“¥ Response status:', response.status);

                const data = await response.json();
                console.log('ğŸ“¥ Response data:', data);

                if (data.success) {
                    console.log('âœ… Analysis successful');
                    displayResult(data);
                } else {
                    console.error('âŒ Analysis failed:', data.error);
                    showError(data.error || 'ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (err) {
                console.error('âŒ API Error:', err);
                showError('ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = 'ë¶„ì„ ì‹œì‘';
            }
        });

        // ì´ˆê¸°í™”
        resetBtn.addEventListener('click', () => {
            selectedFile = null;
            fileInput.value = '';
            fileName.textContent = 'ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”';
            previewSection.classList.remove('show');
            errorMessage.classList.remove('show');
            aiOption.classList.remove('show');
            resetBtn.classList.remove('show');
            resultSection.classList.remove('show');
            analyzeBtn.disabled = true;
            useAI.checked = false;
        });

        // ì—ëŸ¬ í‘œì‹œ
        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.add('show');
        }

        // ê²°ê³¼ í‘œì‹œ
        function displayResult(data) {
            const { ocr_result, analysis_result } = data;

            // í†µê³¼/ë°˜ë ¤ íŒì •
            const judgment = getJudgment(analysis_result.risk_level);

            let html = `
                <!-- ì¢…í•© íŒì • ì¹´ë“œ -->
                <div class="result-card judgment-card">
                    <div class="judgment-header">
                        <h3>ì¢…í•© íŒì •</h3>
                        <span class="judgment-badge ${judgment.className}">${judgment.text}</span>
                    </div>
                    <div class="judgment-content">
                        <div class="judgment-item">
                            <span class="judgment-label">ì´ ìœ„ë°˜ ì ìˆ˜</span>
                            <span class="judgment-value risk-${analysis_result.risk_level.toLowerCase()}">${analysis_result.total_score}ì </span>
                        </div>
                        <div class="judgment-item">
                            <span class="judgment-label">ìœ„í—˜ë„ ë“±ê¸‰</span>
                            <span class="judgment-value risk-badge-large risk-${analysis_result.risk_level.toLowerCase()}">${analysis_result.risk_level}</span>
                        </div>
                        <div class="judgment-item">
                            <span class="judgment-label">ìœ„ë°˜ ê±´ìˆ˜</span>
                            <span class="judgment-value">${analysis_result.violation_count}ê±´</span>
                        </div>
                    </div>
                    <div class="judgment-summary">
                        <p>${analysis_result.summary}</p>
                    </div>
                </div>

                <!-- OCR ì¶”ì¶œ í…ìŠ¤íŠ¸ -->
                <div class="result-card">
                    <h3>ì¶”ì¶œëœ í…ìŠ¤íŠ¸</h3>
                    <div class="ocr-text-highlighted">${highlightKeywords(ocr_result.text, analysis_result.violations)}</div>
                    <p class="ocr-confidence">OCR ì‹ ë¢°ë„: ${(ocr_result.confidence * 100).toFixed(1)}%</p>
                </div>
            `;

            // ìœ„ë°˜ ì‚¬í•­ ìƒì„¸
            if (analysis_result.violations && analysis_result.violations.length > 0) {
                html += `
                    <div class="result-card">
                        <h3>ìœ„ë°˜ ì‚¬í•­ ìƒì„¸ (${analysis_result.violation_count}ê±´)</h3>
                        <div class="violations-detail-list">
                `;

                analysis_result.violations.forEach(v => {
                    html += `
                        <div class="violation-detail-card">
                            <div class="violation-detail-header">
                                <span class="violation-severity-badge ${v.severity.toLowerCase()}">${v.severity}</span>
                                <span class="violation-keyword-main">${v.keyword}</span>
                                <span class="violation-score-badge">${v.total_score}ì </span>
                            </div>
                            <div class="violation-detail-body">
                                <div class="violation-info-row">
                                    <span class="info-label">ë¶„ë¥˜:</span>
                                    <span class="info-value">${v.category}</span>
                                </div>
                                <div class="violation-info-row">
                                    <span class="info-label">ê²€ì¶œ íšŸìˆ˜:</span>
                                    <span class="info-value">
                                        ${v.count}íšŒ
                                        ${v.repetition_bonus > 0 ? `<span class="bonus-indicator"> (+${v.repetition_bonus}ì  ê°€ì‚°)</span>` : ''}
                                    </span>
                                </div>
                                <div class="violation-info-row">
                                    <span class="info-label">ê´€ë ¨ ë²•ê·œ:</span>
                                    <span class="info-value law-text">${v.law}</span>
                                </div>
                                <div class="violation-description">
                                    <span class="info-label">ì„¤ëª…:</span>
                                    <p class="info-value">${v.description}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            }

            // AI ë¶„ì„ ê·¼ê±°
            if (analysis_result.ai_analysis) {
                html += `
                    <div class="result-card ai-analysis-card">
                        <h3>AI ë¶„ì„ ê·¼ê±° (GPT-4)</h3>
                        <div class="ai-analysis-content">
                            <pre class="ai-analysis-text">${analysis_result.ai_analysis}</pre>
                        </div>
                    </div>
                `;
            }

            resultContent.innerHTML = html;
            resultSection.classList.add('show');
        }

        // í†µê³¼/ë°˜ë ¤ íŒì •
        function getJudgment(riskLevel) {
            const level = riskLevel.toUpperCase();
            if (level === 'SAFE' || level === 'LOW') {
                return { text: 'í†µê³¼', className: 'passed' };
            } else {
                return { text: 'ë°˜ë ¤', className: 'rejected' };
            }
        }

        // í‚¤ì›Œë“œ í•˜ì´ë¼ì´íŒ…
        function highlightKeywords(text, violations) {
            if (!text || !violations || violations.length === 0) {
                return text;
            }

            // í‚¤ì›Œë“œì™€ severity ë§¤í•‘
            const keywordMap = {};
            violations.forEach(v => {
                if (v.keyword) {
                    keywordMap[v.keyword.toLowerCase()] = v.severity.toLowerCase();
                }
            });

            // í‚¤ì›Œë“œë¥¼ ê¸¸ì´ ìˆœìœ¼ë¡œ ì •ë ¬
            const keywords = Object.keys(keywordMap).sort((a, b) => b.length - a.length);

            if (keywords.length === 0) {
                return text;
            }

            // íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„
            const escapeRegex = (str) => str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');

            // ì •ê·œí‘œí˜„ì‹ ìƒì„±
            const pattern = keywords.map(k => escapeRegex(k)).join('|');
            const regex = new RegExp(`(${pattern})`, 'gi');

            // í…ìŠ¤íŠ¸ ì¹˜í™˜
            return text.replace(regex, (match) => {
                const severity = keywordMap[match.toLowerCase()];
                return `<span class="highlight-${severity}">${match}</span>`;
            });
        }

        // ==================== ë°°ì¹˜ ì—…ë¡œë“œ ë¡œì§ ====================

        // ë°°ì¹˜ ì—…ë¡œë“œ ê´€ë ¨ ë³€ìˆ˜
        let selectedBatchFiles = [];
        let currentBatchId = null;
        let pollingInterval = null;
        let batchResults = [];
        let currentFilter = 'all';
        let currentSort = 'filename';
        let filteredResults = [];  // í•„í„°ë§ëœ ê²°ê³¼ ì €ì¥

        // ë°°ì¹˜ DOM ìš”ì†Œ
        const batchFileInput = document.getElementById('batch-file-input');
        const selectedFilesList = document.getElementById('selected-files-list');
        const batchAiOption = document.getElementById('batch-ai-option');
        const batchUseAI = document.getElementById('batch-use-ai');
        const batchAnalyzeBtn = document.getElementById('batch-analyze-btn');
        const batchResetBtn = document.getElementById('batch-reset-btn');
        const progressSection = document.getElementById('progress-section');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const batchResultSection = document.getElementById('batch-result-section');
        const resultsTableBody = document.getElementById('results-table-body');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const sortSelect = document.getElementById('sort-select');
        const classifyBtn = document.getElementById('classify-btn');

        // ë°°ì¹˜ íŒŒì¼ ì„ íƒ í•¸ë“¤ëŸ¬
        batchFileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);

            if (files.length === 0) return;

            // íŒŒì¼ ìˆ˜ ì œí•œ
            if (files.length > 50) {
                alert('ìµœëŒ€ 50ê°œì˜ íŒŒì¼ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                batchFileInput.value = '';
                return;
            }

            // íŒŒì¼ ê²€ì¦
            for (const file of files) {
                if (!file.type.startsWith('image/')) {
                    alert(`ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤: ${file.name}`);
                    batchFileInput.value = '';
                    return;
                }
                if (file.size > 10 * 1024 * 1024) {
                    alert(`íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤: ${file.name}`);
                    batchFileInput.value = '';
                    return;
                }
            }

            selectedBatchFiles = files;
            displaySelectedFiles(files);
            batchAiOption.style.display = 'block';
            batchAnalyzeBtn.disabled = false;
            batchResetBtn.style.display = 'inline-block';
        });

        // ì„ íƒëœ íŒŒì¼ ëª©ë¡ í‘œì‹œ
        function displaySelectedFiles(files) {
            selectedFilesList.innerHTML = '';
            selectedFilesList.classList.add('show');

            files.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span class="file-item-name">${file.name}</span>
                    <span class="file-item-size">${(file.size / 1024).toFixed(1)} KB</span>
                `;
                selectedFilesList.appendChild(fileItem);
            });
        }

        // ë°°ì¹˜ ë¶„ì„ ì‹œì‘
        batchAnalyzeBtn.addEventListener('click', async () => {
            if (selectedBatchFiles.length === 0) return;

            batchAnalyzeBtn.disabled = true;
            batchAnalyzeBtn.textContent = 'ë¶„ì„ ì¤‘...';
            progressSection.style.display = 'block';
            batchResultSection.style.display = 'none';

            try {
                const formData = new FormData();
                selectedBatchFiles.forEach(file => {
                    formData.append('files', file);
                });
                formData.append('use_ai', batchUseAI.checked ? 'true' : 'false');

                const response = await fetch(`${API_BASE_URL}/api/batch-upload-analyze`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'ë°°ì¹˜ ë¶„ì„ ì‹œì‘ ì‹¤íŒ¨');
                }

                const data = await response.json();
                currentBatchId = data.batch_id;

                // í´ë§ ì‹œì‘
                startPolling(currentBatchId);

            } catch (error) {
                alert(`ì˜¤ë¥˜: ${error.message}`);
                batchAnalyzeBtn.disabled = false;
                batchAnalyzeBtn.textContent = 'ë°°ì¹˜ ë¶„ì„ ì‹œì‘';
                progressSection.style.display = 'none';
            }
        });

        // í´ë§ ì‹œì‘
        function startPolling(batchId) {
            pollingInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/batch-status/${batchId}`);

                    if (!response.ok) {
                        throw new Error('ë°°ì¹˜ ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨');
                    }

                    const status = await response.json();
                    updateProgress(status);

                    if (status.status === 'completed') {
                        clearInterval(pollingInterval);
                        batchResults = status.results;
                        showBatchResults(status.results);
                        batchAnalyzeBtn.disabled = false;
                        batchAnalyzeBtn.textContent = 'ë°°ì¹˜ ë¶„ì„ ì‹œì‘';
                        progressSection.style.display = 'none';
                    } else if (status.status === 'failed') {
                        clearInterval(pollingInterval);
                        alert('ë°°ì¹˜ ë¶„ì„ ì‹¤íŒ¨: ' + (status.errors.join(', ') || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                        batchAnalyzeBtn.disabled = false;
                        batchAnalyzeBtn.textContent = 'ë°°ì¹˜ ë¶„ì„ ì‹œì‘';
                        progressSection.style.display = 'none';
                    }

                } catch (error) {
                    console.error('í´ë§ ì˜¤ë¥˜:', error);
                }
            }, 2000); // 2ì´ˆë§ˆë‹¤ í´ë§
        }

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress(status) {
            const percent = status.progress_percent.toFixed(1);
            progressBar.style.width = `${percent}%`;
            progressBar.textContent = `${percent}%`;
            progressText.textContent = `${status.processed_files}/${status.total_files} (${percent}%)`;
        }

        // ë°°ì¹˜ ê²°ê³¼ í‘œì‹œ
        function showBatchResults(results) {
            batchResultSection.style.display = 'block';
            renderResultsTable(results, currentFilter, currentSort);
        }

        // ê²°ê³¼ í…Œì´ë¸” ë Œë”ë§
        function renderResultsTable(results, filter, sortBy) {
            // í•„í„°ë§
            filteredResults = results.filter(r => {
                if (!r.success || !r.analysis_result) return false;
                if (filter === 'all') return true;
                const category = getCategory(r.analysis_result.risk_level);
                return category === filter;
            });

            // ì •ë ¬
            filteredResults.sort((a, b) => {
                if (sortBy === 'filename') {
                    return a.filename.localeCompare(b.filename);
                } else if (sortBy === 'score') {
                    return (b.analysis_result?.total_score || 0) - (a.analysis_result?.total_score || 0);
                } else if (sortBy === 'risk') {
                    const riskOrder = { 'CRITICAL': 5, 'HIGH': 4, 'MEDIUM': 3, 'LOW': 2, 'SAFE': 1 };
                    return (riskOrder[b.analysis_result?.risk_level] || 0) - (riskOrder[a.analysis_result?.risk_level] || 0);
                }
                return 0;
            });

            // í…Œì´ë¸” ë Œë”ë§
            resultsTableBody.innerHTML = '';

            filteredResults.forEach((result, index) => {
                const { filename, analysis_result } = result;
                const judgment = getJudgmentForTable(analysis_result.risk_level);
                const category = getCategory(analysis_result.risk_level);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${filename}</td>
                    <td><span class="table-judgment ${judgment.className}">${judgment.text}</span></td>
                    <td>${analysis_result.total_score}ì </td>
                    <td><span class="table-risk-badge risk-${analysis_result.risk_level.toLowerCase()}">${analysis_result.risk_level}</span></td>
                    <td>${analysis_result.violation_count}ê±´</td>
                    <td><button class="view-detail-btn" onclick="viewDetail(${index})">ìƒì„¸</button></td>
                `;
                resultsTableBody.appendChild(row);
            });

            if (filteredResults.length === 0) {
                resultsTableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            }
        }

        // ìƒì„¸ë³´ê¸°
        window.viewDetail = function(index) {
            const result = filteredResults[index];
            if (!result || !result.success) return;

            // ë‹¨ì¼ íŒŒì¼ ê²°ê³¼ ì„¹ì…˜ì— í‘œì‹œ
            resultSection.classList.add('show');
            const { ocr_result, analysis_result } = result;

            let html = `
                <!-- ì¢…í•© íŒì • ì¹´ë“œ -->
                <div class="result-card judgment-card">
                    <div class="judgment-header">
                        <h3>ì¢…í•© íŒì •</h3>
                        <span class="judgment-badge ${getJudgment(analysis_result.risk_level).className}">
                            ${getJudgment(analysis_result.risk_level).text}
                        </span>
                    </div>
                    <div class="judgment-content">
                        <div class="judgment-item">
                            <span class="judgment-label">íŒŒì¼ëª…</span>
                            <span class="judgment-value">${result.filename}</span>
                        </div>
                        <div class="judgment-item">
                            <span class="judgment-label">ì´ ìœ„ë°˜ ì ìˆ˜</span>
                            <span class="judgment-value score-${analysis_result.risk_level.toLowerCase()}">
                                ${analysis_result.total_score}ì 
                            </span>
                        </div>
                        <div class="judgment-item">
                            <span class="judgment-label">ìœ„í—˜ë„ ë“±ê¸‰</span>
                            <span class="judgment-value risk-badge-large risk-${analysis_result.risk_level.toLowerCase()}">
                                ${analysis_result.risk_level}
                            </span>
                        </div>
                        <div class="judgment-item">
                            <span class="judgment-label">ìœ„ë°˜ ê±´ìˆ˜</span>
                            <span class="judgment-value">${analysis_result.violation_count}ê±´</span>
                        </div>
                    </div>
                    <div class="judgment-summary">
                        <p>${analysis_result.summary}</p>
                    </div>
                </div>

                <!-- OCR ì¶”ì¶œ í…ìŠ¤íŠ¸ -->
                <div class="result-card">
                    <h3>ì¶”ì¶œëœ í…ìŠ¤íŠ¸</h3>
                    <div class="ocr-text-highlighted">${highlightKeywords(ocr_result.text, analysis_result.violations)}</div>
                    <p class="ocr-confidence">OCR ì‹ ë¢°ë„: ${(ocr_result.confidence * 100).toFixed(1)}%</p>
                </div>
            `;

            // ìœ„ë°˜ ì‚¬í•­ ìƒì„¸
            if (analysis_result.violations && analysis_result.violations.length > 0) {
                html += `
                    <div class="result-card">
                        <h3>ìœ„ë°˜ ì‚¬í•­ ìƒì„¸ (${analysis_result.violation_count}ê±´)</h3>
                        <div class="violations-detail-list">
                `;

                analysis_result.violations.forEach(v => {
                    html += `
                        <div class="violation-detail-card">
                            <div class="violation-detail-header">
                                <span class="violation-severity-badge ${v.severity.toLowerCase()}">${v.severity}</span>
                                <span class="violation-keyword-main">${v.keyword}</span>
                                <span class="violation-score-badge">${v.total_score}ì </span>
                            </div>
                            <div class="violation-detail-body">
                                <div class="violation-info-row">
                                    <span class="info-label">ë¶„ë¥˜:</span>
                                    <span class="info-value">${v.category}</span>
                                </div>
                                <div class="violation-info-row">
                                    <span class="info-label">ê²€ì¶œ íšŸìˆ˜:</span>
                                    <span class="info-value">
                                        ${v.count}íšŒ
                                        ${v.repetition_bonus > 0 ? `<span class="bonus-indicator"> (+${v.repetition_bonus}ì  ê°€ì‚°)</span>` : ''}
                                    </span>
                                </div>
                                <div class="violation-info-row">
                                    <span class="info-label">ê´€ë ¨ ë²•ê·œ:</span>
                                    <span class="info-value law-text">${v.law}</span>
                                </div>
                                <div class="violation-description">
                                    <span class="info-label">ì„¤ëª…:</span>
                                    <p class="info-value">${v.description}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            }

            // AI ë¶„ì„ ê·¼ê±°
            if (analysis_result.ai_analysis) {
                html += `
                    <div class="result-card ai-analysis-card">
                        <h3>AI ë¶„ì„ ê·¼ê±° (GPT-4)</h3>
                        <div class="ai-analysis-content">
                            <pre class="ai-analysis-text">${analysis_result.ai_analysis}</pre>
                        </div>
                    </div>
                `;
            }

            resultContent.innerHTML = html;
            resultSection.scrollIntoView({ behavior: 'smooth' });
        };

        // í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                renderResultsTable(batchResults, currentFilter, currentSort);
            });
        });

        // ì •ë ¬ ì„ íƒ ì´ë²¤íŠ¸
        sortSelect.addEventListener('change', (e) => {
            currentSort = e.target.value;
            renderResultsTable(batchResults, currentFilter, currentSort);
        });

        // íŒŒì¼ ë¶„ë¥˜ ë²„íŠ¼
        classifyBtn.addEventListener('click', async () => {
            if (!currentBatchId || batchResults.length === 0) return;

            if (!confirm('ë¶„ì„ ê²°ê³¼ì— ë”°ë¼ íŒŒì¼ì„ ë¶„ë¥˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n- í†µê³¼(SAFE/LOW) â†’ approved í´ë”\n- ë°˜ë ¤(HIGH/CRITICAL) â†’ rejected í´ë”\n- ê²€í† (MEDIUM) â†’ review í´ë”')) {
                return;
            }

            classifyBtn.disabled = true;
            classifyBtn.textContent = 'ë¶„ë¥˜ ì¤‘...';

            try {
                const classifications = batchResults
                    .filter(r => r.success && r.analysis_result)
                    .map(r => ({
                        filename: r.filename,
                        category: getCategory(r.analysis_result.risk_level)
                    }));

                const response = await fetch(`${API_BASE_URL}/api/classify-files`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        batch_id: currentBatchId,
                        classifications: classifications
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'íŒŒì¼ ë¶„ë¥˜ ì‹¤íŒ¨');
                }

                const result = await response.json();
                alert(`íŒŒì¼ ë¶„ë¥˜ ì™„ë£Œ!\n\nì„±ê³µ: ${result.success_count}ê°œ\nì‹¤íŒ¨: ${result.failed_count}ê°œ`);

                if (result.errors.length > 0) {
                    console.error('ë¶„ë¥˜ ì˜¤ë¥˜:', result.errors);
                }

            } catch (error) {
                alert(`ì˜¤ë¥˜: ${error.message}`);
            } finally {
                classifyBtn.disabled = false;
                classifyBtn.textContent = 'ì „ì²´ ìŠ¹ì¸ ë° ë¶„ë¥˜';
            }
        });

        // ë°°ì¹˜ ì´ˆê¸°í™”
        batchResetBtn.addEventListener('click', () => {
            selectedBatchFiles = [];
            currentBatchId = null;
            batchResults = [];
            batchFileInput.value = '';
            selectedFilesList.innerHTML = '';
            selectedFilesList.classList.remove('show');
            batchAiOption.style.display = 'none';
            batchAnalyzeBtn.disabled = true;
            batchResetBtn.style.display = 'none';
            progressSection.style.display = 'none';
            batchResultSection.style.display = 'none';
            batchUseAI.checked = false;

            if (pollingInterval) {
                clearInterval(pollingInterval);
                pollingInterval = null;
            }
        });

        // íŒì • (í…Œì´ë¸”ìš©)
        function getJudgmentForTable(riskLevel) {
            const category = getCategory(riskLevel);
            if (category === 'approved') {
                return { text: 'í†µê³¼', className: 'passed' };
            } else if (category === 'rejected') {
                return { text: 'ë°˜ë ¤', className: 'rejected' };
            } else {
                return { text: 'ê²€í† ', className: 'review' };
            }
        }

        // ì¹´í…Œê³ ë¦¬ ê²°ì •
        function getCategory(riskLevel) {
            const level = riskLevel.toUpperCase();
            if (level === 'SAFE' || level === 'LOW') {
                return 'approved';
            } else if (level === 'HIGH' || level === 'CRITICAL') {
                return 'rejected';
            } else {
                return 'review';
            }
        }
    </script>
</body>
</html>
